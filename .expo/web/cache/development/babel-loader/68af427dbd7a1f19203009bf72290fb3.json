{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport * as React from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Linking from \"react-native-web/dist/exports/Linking\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { ListItem } from \"react-native-elements\";\nimport Icon from \"@expo/vector-icons/Feather\";\nimport { COLORS, DIMENS } from \"../constants/styles\";\nimport AuthContext from \"../contexts/auth\";\nimport { UserContext } from \"../providers/User\";\nimport { tokensRefresh } from \"../helpers/functions\";\nimport Loader from \"../ui/loader\";\nimport { URLS } from \"../constants/API\";\nimport CustomHeader from \"../parts/custom-header\";\nimport { CustomStatusBar } from \"../ui/custom.status.bar\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar Ambulance = function Ambulance(_ref) {\n  var navigation = _ref.navigation;\n\n  var _React$useState = React.useState({\n    isLoading: true,\n    data: []\n  }),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      state = _React$useState2[0],\n      setState = _React$useState2[1];\n\n  var _React$useContext = React.useContext(AuthContext),\n      signOut = _React$useContext.signOut;\n\n  React.useEffect(function () {\n    _getAmbulances();\n  }, [state.data]);\n\n  var _getAmbulances = function _getAmbulances() {\n    var tokenString, tokens, accessToken, response, JSON_RESPONSE, result, msg, _ambulances, _result;\n\n    return _regeneratorRuntime.async(function _getAmbulances$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"tokens\"));\n\n          case 3:\n            tokenString = _context.sent;\n            _context.t0 = tokenString;\n\n            if (!_context.t0) {\n              _context.next = 9;\n              break;\n            }\n\n            _context.next = 8;\n            return _regeneratorRuntime.awrap(JSON.parse(tokenString));\n\n          case 8:\n            _context.t0 = _context.sent;\n\n          case 9:\n            tokens = _context.t0;\n            accessToken = tokens.accessToken;\n\n            if (!accessToken) {\n              _context.next = 37;\n              break;\n            }\n\n            _context.next = 14;\n            return _regeneratorRuntime.awrap(fetch(URLS.BASE + \"/ambulances\", {\n              method: \"GET\",\n              headers: {\n                Authorization: \"Bearer \" + accessToken,\n                \"Content-type\": \"application/json; charset=UTF-8\",\n                Accept: \"application/json\"\n              }\n            }));\n\n          case 14:\n            response = _context.sent;\n            _context.next = 17;\n            return _regeneratorRuntime.awrap(response.json());\n\n          case 17:\n            JSON_RESPONSE = _context.sent;\n            result = JSON_RESPONSE.result, msg = JSON_RESPONSE.msg, _ambulances = JSON_RESPONSE.ambulances;\n\n            if (!(result == \"Success\")) {\n              _context.next = 22;\n              break;\n            }\n\n            setState(_objectSpread(_objectSpread({}, state), {}, {\n              data: _ambulances,\n              isLoading: false\n            }));\n            return _context.abrupt(\"return\");\n\n          case 22:\n            if (!(result == \"Failure\")) {\n              _context.next = 34;\n              break;\n            }\n\n            setState(_objectSpread(_objectSpread({}, state), {}, {\n              isLoading: true\n            }));\n\n            if (!(msg == \"Token expired\")) {\n              _context.next = 31;\n              break;\n            }\n\n            _result = tokensRefresh();\n\n            if (!_result.accessToken) {\n              _context.next = 30;\n              break;\n            }\n\n            _context.next = 29;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"tokens\", JSON.stringify({\n              accessToken: _result.accessToken,\n              refreshToken: _result.refreshToken\n            })));\n\n          case 29:\n            _getAmbulances();\n\n          case 30:\n            return _context.abrupt(\"return\");\n\n          case 31:\n            if (!(msg == \"Invalid Access Token\")) {\n              _context.next = 34;\n              break;\n            }\n\n            signOut();\n            return _context.abrupt(\"return\");\n\n          case 34:\n            console.log(\"Some errors\");\n            console.log(JSON_RESPONSE);\n            Alert.alert(\"Ooops!\", \"Ambulances not found\", [{\n              text: \"OK\"\n            }]);\n\n          case 37:\n            _context.next = 43;\n            break;\n\n          case 39:\n            _context.prev = 39;\n            _context.t1 = _context[\"catch\"](0);\n            Alert.alert(\"Ooops!\", \"Something went wrong. Try again!\", [{\n              text: \"OK\"\n            }]);\n            console.log(_context.t1);\n\n          case 43:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 39]], Promise);\n  };\n\n  var _keyExtractor = function _keyExtractor(item) {\n    return item._id;\n  };\n\n  var _renderItem = function _renderItem(_ref2) {\n    var item = _ref2.item;\n    return _jsx(TouchableOpacity, {\n      onPress: function onPress() {\n        return Linking.openURL(\"tel:\" + item.msdn);\n      },\n      children: _jsxs(ListItem, {\n        bottomDivider: true,\n        children: [_jsx(Icon, {\n          name: \"circle\",\n          size: 25,\n          color: item.status == 1 ? \"green\" : item.status == 2 ? COLORS.PRIMARY : \"#f00\"\n        }), _jsxs(ListItem.Content, {\n          children: [_jsx(ListItem.Title, {\n            style: STYLES.listTitle,\n            children: item.plate\n          }), _jsx(ListItem.Subtitle, {\n            style: STYLES.subtitle,\n            children: _jsxs(View, {\n              style: STYLES.wrapper,\n              children: [_jsxs(View, {\n                style: STYLES.subtitle,\n                children: [_jsx(Text, {\n                  style: STYLES.label,\n                  children: \"Driver\"\n                }), _jsx(Text, {\n                  children: item.driver\n                })]\n              }), _jsxs(View, {\n                style: STYLES.subtitle,\n                children: [_jsx(Text, {\n                  style: STYLES.label,\n                  children: \"Hospital\"\n                }), _jsx(Text, {\n                  children: item.hospital\n                })]\n              }), _jsxs(View, {\n                style: STYLES.subtitle,\n                children: [_jsx(Text, {\n                  style: STYLES.label,\n                  children: \"Location\"\n                }), _jsx(Text, {\n                  children: item.location\n                })]\n              }), _jsx(View, {\n                style: STYLES.subtitle\n              })]\n            })\n          })]\n        }), _jsx(Icon, {\n          name: \"phone\",\n          size: 25,\n          color: \"rgba(0,0,0,.3)\"\n        })]\n      })\n    });\n  };\n\n  var _header = function _header() {\n    return _jsx(CustomHeader, {\n      left: _jsx(TouchableOpacity, {\n        style: {\n          paddingLeft: 10\n        },\n        onPress: function onPress() {\n          return navigation.openDrawer();\n        },\n        children: _jsx(Icon, {\n          name: \"menu\",\n          size: 25,\n          color: COLORS.SECONDARY\n        })\n      }),\n      title: _jsx(Text, {\n        style: [STYLES.centerHeader, STYLES.title],\n        children: \"Ambulances\"\n      })\n    });\n  };\n\n  var ambulances = state.data,\n      isLoading = state.isLoading;\n  if (isLoading) return _jsx(Loader, {});\n  if (typeof ambulances === \"object\" && ambulances.length == 0) return _jsxs(View, {\n    style: STYLES.wrapper,\n    children: [_jsx(CustomStatusBar, {}), _header(), _jsxs(View, {\n      style: STYLES.body,\n      children: [_jsx(Icon, {\n        name: \"smile\",\n        size: 60,\n        color: COLORS.GREY\n      }), _jsx(Text, {\n        style: STYLES.alert,\n        children: \"Can't not find Ambulances to show.\"\n      })]\n    })]\n  });\n  return _jsxs(View, {\n    style: STYLES.wrapper,\n    children: [_jsx(CustomStatusBar, {}), _header(), _jsx(FlatList, {\n      data: ambulances,\n      renderItem: _renderItem,\n      keyExtractor: _keyExtractor\n    })]\n  });\n};\n\nvar STYLES = StyleSheet.create({\n  wrapper: {\n    flex: 1,\n    backgroundColor: COLORS.SECONDARY\n  },\n  header: {\n    flex: 1\n  },\n  body: {\n    flex: 2,\n    justifyContent: \"center\",\n    alignItems: \"center\"\n  },\n  title: {\n    fontWeight: \"bold\",\n    color: COLORS.SECONDARY,\n    textAlign: \"center\"\n  },\n  alert: {\n    color: COLORS.GREY,\n    textAlign: \"center\",\n    marginTop: 15\n  },\n  listTitle: {\n    fontSize: 16,\n    fontWeight: \"bold\"\n  },\n  subtitle: {\n    flexDirection: \"row\",\n    fontSize: 10,\n    opacity: 0.5\n  },\n  label: {\n    fontWeight: \"bold\",\n    marginRight: 5\n  },\n  leftHeader: {\n    flex: 1,\n    paddingLeft: 10\n  },\n  centerHeader: {\n    flex: 2,\n    flexDirection: \"row\"\n  },\n  rightHeader: {\n    flex: 1,\n    flexDirection: \"row\",\n    justifyContent: \"flex-end\"\n  }\n});\nexport default Ambulance;","map":{"version":3,"sources":["/Users/davidofug/Documents/Apps/mobile-apps/mobiklinic/components/screens/ambulance.js"],"names":["React","AsyncStorage","ListItem","Icon","COLORS","DIMENS","AuthContext","UserContext","tokensRefresh","Loader","URLS","CustomHeader","CustomStatusBar","Ambulance","navigation","useState","isLoading","data","state","setState","useContext","signOut","useEffect","_getAmbulances","getItem","tokenString","JSON","parse","tokens","accessToken","fetch","BASE","method","headers","Authorization","Accept","response","json","JSON_RESPONSE","result","msg","ambulances","setItem","stringify","refreshToken","console","log","Alert","alert","text","_keyExtractor","item","_id","_renderItem","Linking","openURL","msdn","status","PRIMARY","STYLES","listTitle","plate","subtitle","wrapper","label","driver","hospital","location","_header","paddingLeft","openDrawer","SECONDARY","centerHeader","title","length","body","GREY","StyleSheet","create","flex","backgroundColor","header","justifyContent","alignItems","fontWeight","color","textAlign","marginTop","fontSize","flexDirection","opacity","marginRight","leftHeader","rightHeader"],"mappings":"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","sourcesContent":["import * as React from \"react\";\r\nimport {\r\n  View,\r\n  Alert,\r\n  Linking,\r\n  FlatList,\r\n  TouchableOpacity,\r\n  Text,\r\n  StyleSheet,\r\n} from \"react-native\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n\r\nimport { ListItem } from \"react-native-elements\";\r\nimport Icon from \"react-native-vector-icons/Feather\";\r\n\r\nimport { COLORS, DIMENS } from \"../constants/styles\";\r\nimport AuthContext from \"../contexts/auth\";\r\nimport { UserContext } from \"../providers/User\";\r\nimport { tokensRefresh } from \"../helpers/functions\";\r\nimport Loader from \"../ui/loader\";\r\nimport { URLS } from \"../constants/API\";\r\n\r\nimport CustomHeader from \"../parts/custom-header\";\r\nimport { CustomStatusBar } from \"../ui/custom.status.bar\";\r\n\r\nconst Ambulance = ({ navigation }) => {\r\n  const [state, setState] = React.useState({ isLoading: true, data: [] });\r\n  const { signOut } = React.useContext(AuthContext);\r\n\r\n  React.useEffect(() => {\r\n    _getAmbulances();\r\n  }, [state.data]);\r\n\r\n  const _getAmbulances = async () => {\r\n    try {\r\n      const tokenString = await AsyncStorage.getItem(\"tokens\");\r\n      const tokens = tokenString && (await JSON.parse(tokenString));\r\n      const { accessToken } = tokens;\r\n\r\n      if (accessToken) {\r\n        const response = await fetch(`${URLS.BASE}/ambulances`, {\r\n          method: \"GET\",\r\n          headers: {\r\n            Authorization: \"Bearer \" + accessToken,\r\n            \"Content-type\": \"application/json; charset=UTF-8\",\r\n            Accept: \"application/json\",\r\n          },\r\n        });\r\n        const JSON_RESPONSE = await response.json();\r\n\r\n        const { result, msg, ambulances } = JSON_RESPONSE;\r\n\r\n        if (result == \"Success\") {\r\n          setState({ ...state, data: ambulances, isLoading: false });\r\n          return;\r\n        }\r\n\r\n        if (result == \"Failure\") {\r\n          setState({ ...state, isLoading: true });\r\n\r\n          if (msg == \"Token expired\") {\r\n            const result = tokensRefresh();\r\n            if (result.accessToken) {\r\n              // userContext.setAccessToken(result.accessToken)\r\n              await AsyncStorage.setItem(\r\n                \"tokens\",\r\n                JSON.stringify({\r\n                  accessToken: result.accessToken,\r\n                  refreshToken: result.refreshToken,\r\n                })\r\n              );\r\n              _getAmbulances();\r\n            }\r\n            return;\r\n          }\r\n\r\n          if (msg == \"Invalid Access Token\") {\r\n            signOut();\r\n            return;\r\n          }\r\n        }\r\n\r\n        console.log(\"Some errors\");\r\n        console.log(JSON_RESPONSE);\r\n\r\n        Alert.alert(`Ooops!`, `Ambulances not found`, [{ text: \"OK\" }]);\r\n      }\r\n    } catch (e) {\r\n      Alert.alert(`Ooops!`, `Something went wrong. Try again!`, [\r\n        { text: \"OK\" },\r\n      ]);\r\n\r\n      console.log(e);\r\n    }\r\n  };\r\n\r\n  const _keyExtractor = (item) => item._id;\r\n\r\n  const _renderItem = ({ item }) => {\r\n    return (\r\n      <TouchableOpacity onPress={() => Linking.openURL(`tel:${item.msdn}`)}>\r\n        <ListItem bottomDivider>\r\n          <Icon\r\n            name=\"circle\"\r\n            size={25}\r\n            color={\r\n              item.status == 1\r\n                ? \"green\"\r\n                : item.status == 2\r\n                ? COLORS.PRIMARY\r\n                : \"#f00\"\r\n            }\r\n          />\r\n          <ListItem.Content>\r\n            <ListItem.Title style={STYLES.listTitle}>\r\n              {item.plate}\r\n            </ListItem.Title>\r\n            <ListItem.Subtitle style={STYLES.subtitle}>\r\n              <View style={STYLES.wrapper}>\r\n                <View style={STYLES.subtitle}>\r\n                  <Text style={STYLES.label}>Driver</Text>\r\n                  <Text>{item.driver}</Text>\r\n                </View>\r\n                <View style={STYLES.subtitle}>\r\n                  <Text style={STYLES.label}>Hospital</Text>\r\n                  <Text>{item.hospital}</Text>\r\n                </View>\r\n                <View style={STYLES.subtitle}>\r\n                  <Text style={STYLES.label}>Location</Text>\r\n                  <Text>{item.location}</Text>\r\n                </View>\r\n                <View style={STYLES.subtitle}></View>\r\n              </View>\r\n            </ListItem.Subtitle>\r\n          </ListItem.Content>\r\n          <Icon name=\"phone\" size={25} color=\"rgba(0,0,0,.3)\" />\r\n        </ListItem>\r\n      </TouchableOpacity>\r\n    );\r\n  };\r\n\r\n  const _header = () => (\r\n    <CustomHeader\r\n      left={\r\n        <TouchableOpacity\r\n          style={{ paddingLeft: 10 }}\r\n          onPress={() => navigation.openDrawer()}\r\n        >\r\n          <Icon name=\"menu\" size={25} color={COLORS.SECONDARY} />\r\n        </TouchableOpacity>\r\n      }\r\n      title={\r\n        <Text style={[STYLES.centerHeader, STYLES.title]}>Ambulances</Text>\r\n      }\r\n    />\r\n  );\r\n\r\n  let { data: ambulances, isLoading } = state;\r\n\r\n  if (isLoading) return <Loader />;\r\n\r\n  if (typeof ambulances === \"object\" && ambulances.length == 0)\r\n    return (\r\n      <View style={STYLES.wrapper}>\r\n        <CustomStatusBar />\r\n\r\n        {_header()}\r\n\r\n        <View style={STYLES.body}>\r\n          <Icon name=\"smile\" size={60} color={COLORS.GREY} />\r\n          <Text style={STYLES.alert}>Can't not find Ambulances to show.</Text>\r\n        </View>\r\n      </View>\r\n    );\r\n\r\n  return (\r\n    <View style={STYLES.wrapper}>\r\n      <CustomStatusBar />\r\n      {_header()}\r\n\r\n      <FlatList\r\n        data={ambulances}\r\n        renderItem={_renderItem}\r\n        keyExtractor={_keyExtractor}\r\n      />\r\n    </View>\r\n  );\r\n};\r\n\r\nconst STYLES = StyleSheet.create({\r\n  wrapper: {\r\n    flex: 1,\r\n    backgroundColor: COLORS.SECONDARY,\r\n  },\r\n  header: {\r\n    flex: 1,\r\n  },\r\n  body: {\r\n    flex: 2,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  },\r\n  title: {\r\n    fontWeight: \"bold\",\r\n    color: COLORS.SECONDARY,\r\n    textAlign: \"center\",\r\n  },\r\n  alert: {\r\n    color: COLORS.GREY,\r\n    textAlign: \"center\",\r\n    marginTop: 15,\r\n  },\r\n  listTitle: {\r\n    fontSize: 16,\r\n    fontWeight: \"bold\",\r\n  },\r\n  subtitle: {\r\n    flexDirection: \"row\",\r\n    fontSize: 10,\r\n    opacity: 0.5,\r\n  },\r\n  label: {\r\n    fontWeight: \"bold\",\r\n    marginRight: 5,\r\n  },\r\n  leftHeader: {\r\n    flex: 1,\r\n    paddingLeft: 10,\r\n  },\r\n  centerHeader: {\r\n    flex: 2,\r\n    flexDirection: \"row\",\r\n  },\r\n  rightHeader: {\r\n    flex: 1,\r\n    flexDirection: \"row\",\r\n    justifyContent: \"flex-end\",\r\n  },\r\n});\r\nexport default Ambulance;\r\n"]},"metadata":{},"sourceType":"module"}